
```{r, child="_setup.Rmd"}
```

# Running MethylAid #
	
Sample quality control is performed using the
[**MethylAid**](http://bioconductor.org/MethylAid)
[@Iterson2014]. [**MethylAid**](http://bioconductor.org/MethylAid) is
specially designed for quality control of large sets of DNA
methylation data e.g., epigenomewide association studies
(EWAS). Extracting intensities from IDAT files can be done in batches
and/or in parallel to reduce memory load and/or overcome long
run-times. It requires two function calls in going from IDAT files to
launch the interactive web application; `summarize` and
`visualize`. For more information see van Iterson et
al.[@Iterson2014].

First, prepare the targets file, similar to the one used by 
[**MethylAid**](http://bioconductor.org/minfi).

```{r sqc.generatetargets, message=FALSE, results='hide'}
library(BIOSRutils)
path450k <- file.path(RP3DATADIR, "IlluminaHumanMethylation450k")
samplesheets <- getView("methylationSamplesheet")
samplesheets$biobank_id <- gsub("-.*$", "", samplesheets$ids)
samplesheets$Basename <- with(samplesheets,
                              file.path(path450k, "raw", Sentrix_Barcode,
                                        paste(Sentrix_Barcode, Sentrix_Position, sep="_")))
targets <- subset(samplesheets, biobank_id == "LLS")
targets <- targets[!duplicated(targets$run_id),]
```

```{r sqc.targets}
targets[1:5, 1:5]
```

Next, summarize and visualize the data, see the
[MethylAid vignette](https://www.bioconductor.org/packages/release/bioc/vignettes/MethylAid/inst/doc/MethylAid.pdf)
for more details.

```{r sqc.methylaid, eval=FALSE}
library(MethylAid)
library(BiocParallel)
register(MulticoreParam(8, log=TRUE))
path450k <- file.path(RP3DATADIR, "IlluminaHumanMethylation450k/450k/LLS")
load(file.path(path450k, "MethylAid.RData"))
outliers <- visualize(MethylAid)
write.table(outliers,
            file=file.path(path450k, "outliers.txt"),
            quote=FALSE, row.names=FALSE)
```

Check the interactive visualization of the
[LLS 450k data](http://http://bios-vm.bbmrirp3-lumc.surf-hosted.nl:8008/BIOSRutils/DNAm/LLS)
generated by [**MethylAid**](http://bioconductor.org/MethylAid).

It turns out that 5 samples do not pass quality control.

