
```{r, child="_setup.Rmd"}
```

# Constructing an `RGset`-object in parallel #

Reading a large number of IDAT-files can be time-consuming. The
**DNAmArray** package offers the `read.450k.exp.par`-function for
reading IDAT-files in parallel using functionallity from
[**BiocParallel**](http://bioconductor.org/BiocParallel). The
target-file is divided in a number of smaller targets files according
to the number of workers (compute nodes) available. On each worknode a
subset of IDAT-files are read using the regular
[**minfi**](http://bioconductor.org/minfi)
function-`read.450k.expr`. Once all idat-files are read they are
combined into on `RGChannelSet`-object and returned.

First, we remove those samples that did not pass quality control.

```{r ri.removeoutliers}
path450k <- file.path(RP3DATADIR, "IlluminaHumanMethylation450k/450k/LLS")
outliers <- read.table(file.path(path450k, "outliers.txt"), header=TRUE)    
targets <- targets[!(targets$ids %in% outliers$ids), ]
```

# Using multiple cores #
	
```{r ri.readidats, results='hide', messages=FALSE}
library(BiocParallel)
library(DNAmArray)
register(MulticoreParam(8))
RGset <- read.450k.exp.par(targets, verbose=TRUE, extended=TRUE)
```

```{r ri.rgset}
RGset
```

Reading data in parallel can go wrong and often debugging is
difficult. Recently,
[**BiocParallel**](http://bioconductor.org/BiocParallel) has been
extended with a comprehensive set of functions for debugging for the
various parallel architectures. We recommend running
e.g. `MulticoreParam` with option `log=TRUE`.

# On a cluster #
     
[**BiocParallel**](http://bioconductor.org/BiocParallel) offers
functionality to run jobs in parallel on various architectures e.g. on
a Sun Grid Enginge.

```{r cluster, eval=FALSE}
library(BiocParallel)
library(BatchJobs)
library(MethylAid)
CONF.FILE <- system.file("scripts/config.R", package="MethylAid")
register(BatchJobsParam(workers = 10, progressbar = TRUE, conffile = CONF.FILE))
RGset <- read.450k.exp.par(targets, verbose=TRUE, extended=FALSE)
```


