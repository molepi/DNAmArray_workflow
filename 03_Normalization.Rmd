
```{r, child="_setup.Rmd"}
```

***

# Principal Components Selection #

Since the default of selecting only two principal components is often too restrictive for this type of data, our `screeplot()` function allows visualisation to help select the optimal number. It plots the final principal component for each possible set against the variance that it would explain. 

```{r echo=FALSE, message=FALSE}
load("./data/targets.RData")
targets$Basename <- substring(targets$supplementary_file,68,95)
setwd("C:/Users/ljsinke/Documents/2_r/cd/IDATs")
library(minfi)
RGset <- read.metharray.exp(base=NULL, targets, extended=TRUE)
```

```{r}
pc <- screeplot(RGset)
``` 

This plot shows a sharp drop-off of variance explained after the fifth principal component. For this reason, we choose to carry out normalization using 4 principal components.

***

# Functional normalization #

Our workflow uses the Functional Normalization approach [@Fortin2014], since this includes both NOOB background correction and a dye bias correction step [@Triche2013]. 

>Add section justifying choice of normalization technique.

By default, functional normalization returns normalized copy number data making the returned `GenomicRatioSet` twice the size necessary when only beta-values or M-values are required. Therefore, we developed `preprocessFunnorm.DNAmArray()`, which adds an option not to return these to the `preprocessFunnorm()` function from [**minfi**](https://bioconductor.org/packages/release/bioc/html/minfi.html) [@Aryee2014].

```{r funnorm}
GRset <- preprocessFunnorm.DNAmArray(RGset, nPCs=4, keepCN=FALSE)
```

This function returns beta-values calculated with an offset of 100, similar to specifying `getBeta()` with option `type='Illumina'`. If required, these can be transformed to M-values using [**minfi**](https://bioconductor.org/packages/release/bioc/html/minfi.html)'s `getM()` which applies a logit2-transformation to the beta-values.

***

# References #


