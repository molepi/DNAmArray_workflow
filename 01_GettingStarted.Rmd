
***

# Installation #
  
The [**DNAmArray**](https://github.com/molepi/DNAmArray) package can be installed in several ways, and has been tested for >= R-4.4.3 on various Linux-builds and Windows.

***

### Install using **devtools** ###

First, install [**devtools**](https://github.com/hadley/devtools), and then use the `install_github()` function to fetch the [**DNAmArray**](https://github.com/molepi/DNAmArray) package.

```{r 101devtools, eval=FALSE}
library(devtools)
install_github("molepi/DNAmArray")
```

***

### Install from source using `git/R` ###

Using [git](https://git-scm.com/), you can `git clone` our repository and then install the package, changing `_x.y.z.` to the relevant version.

```{r 102git, eval=FALSE}
git clone git@github.com/molepi/DNAmArray.git
R CMD build DNAmArray
R CMD INSTALL DNAmArray_x.y.z.tar.gz
```

***

# Importing IDATs #

The first step in analysing microarray data is importing raw intensity files into your software program. In this example, we show how to import raw IDAT files from GEO into R, but similar strategies can be employed for all Illumina DNAm array files when using R. 

[**GEOquery**](https://bioconductor.org/packages/release/bioc/html/GEOquery.html)<sup>1</sup>, a package containing functions that bridge the gap between [BioConductor](https://www.bioconductor.org) tools and [GEO](https://www.ncbi.nlm.nih.gov/geo/), can be used to download the [example data](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE113018)<sup>2</sup>. 

```{r 103geoquery, message=FALSE}
library(DNAmArray)
library(GEOquery)
```

Using the `getGEOSuppFiles()` function, supplementary data is downloaded to the current working directory. These consist of the raw IDAT files alongside relevant documentation. 

```{r 104getgeofiles, eval=FALSE}
getGEOSuppFiles("GSE116339")
untar(tarfile="../GSE116339/GSE116339_RAW.tar", exdir="../GSE116339/IDATs")
```

The data can then be efficiently unpacked using the `gunzip()` function.

```{r 104idats, eval=FALSE}
setwd("../GSE116339/IDATs")
sapply(list.files(), gunzip)
```

`getGEO()` can then be used to import SOFT format microarray data into R as a large GSE-class list, and extract the metadata of interest. 

```{r 105getgeo}
GSE116339 <- getGEO(filename='./data/GSE116339_series_matrix.txt.gz', getGPL = FALSE)
targets <- phenoData(GSE116339)@data
rm(GSE116339)
```

***

# Preparing `targets` #

Before progressing further, take some time to get familiar with the `targets` data frame, removing duplicate information and converting variables to relevant classes. 

``` {r 106structure, warning=F}
library(tidyverse)

targets <- targets %>% dplyr::select(sample_ID = `sample_id:ch1`,
                              geo_accession,
                              sex = `gender:ch1`,
                              age = `age:ch1`,
                              log_total_pbb = `ln(totalpbb):ch1`,
                              pbb_153 = `pbb-153:ch1`,
                              pbb_77 = `pbb-77:ch1`,
                              pbb_101 = `pbb-101:ch1`,
                              pbb_180 = `pbb-180:ch1`,
                              supplementary_file) %>% 
  separate(supplementary_file, sep="_", remove=F, into=c(NA, "plate", "row", NA)) %>% 
  mutate(age = as.numeric(age),
         log_total_pbb = as.numeric(log_total_pbb),
         pbb_153 = as.numeric(pbb_153),
         pbb_77 = as.numeric(pbb_77),
         pbb_101 = as.numeric(pbb_101),
         pbb_180 = as.numeric(pbb_180),
         row = as.numeric(substr(row, 3, 3)))

str(targets)
```

This data frame consists of 679 observations and phenotypic information for 51 variables is stored after cleaning. This includes:

* `sample_ID` - the ID of the sample
* `geo_accession` - the GEO accession number of the sample
* `sex` - male or female
* `age` - age of the individual
* `log_total_pbb`, `pbb_153`, `pbb_77`, `pb_101`, `pbb_180` - exposure levels
* `supplementary_file` - location of IDAT file
* `plate` - EPIC array number
* `row` - row number on the array (continuous)

***

# References #

<sup>1</sup> Davis, S. and Meltzer, P.S. [GEOquery: a bridge between the Gene Expression Omnibus (GEO) and BioConductor](https://doi.org/10.1093/bioinformatics/btm254). <i>Bioinformatics.</i> <b>23</b>, 14 (2007).

<sup>2</sup> Curtis, S.W., Cobb, D.O., Kilaru, V. <i>et al</i>. [Exposure to polybrominated biphenyl (PBB) associates with genome-wide DNA methylation differences in peripheral blood](https://doi.org/10.1080/15592294.2019.1565590). <i>Epigenetics.</i> <b>14</b>, 1:52-66 (2019).


