
```{r, child="_setup.Rmd"}
```

Here we show different ways to inspect the 450k with emphasis on fast
and efficient tools for large data sets...

# Beta densities #

Inspect distribution of beta-densities across all samples can be done
either before and after normalization. The following is just just take
from [**minfi**](http://bioconductor.org/minfi).

```{r}
library(minfi)
densityPlot(RGset[, 1:10], main = "Beta", xlab = "Beta")
``` 

# Principal components plot #

Using the
[**irlba**](https://cran.r-project.org/package=irlba)-package for
efficient calculation of principal components, e.g., specifying the
maximum number of PCs to calculate. ***The irlba-algorithm doesn't
allow any NA's***

```{r irlba}
library(irlba)
beta <- getBeta(RGset, type="Illumina")
beta[is.na(beta)] <- median(beta, na.rm=TRUE)
pc <- prcomp_irlba(t(beta), n=3)
summary(pc)
plot(pc$x)
```

**Note** `getBeta` extracts Methylated and Unmethylated intensities
and converts them to beta-values using $\nicefrac{M}{M+U}$, whereas,
`type="Illumina"` adds $100$ to the denominator which prevents
beta-values becoming NA if both M and U are exactly zero.

# Heatmap #

Inspect heatmap correlations of control probes with
technical/biological covariates:

```{r heatmap}
library(pheatmap)
df <- apply(targets, 2, function(x) as.numeric(factor(x)))
keep <- apply(df, 2, sd) > 0    
cxy <- cor(pc$x, scale(df[, keep]))   
pheatmap(cxy, cluster_rows=FALSE)
```

# Dendrogram #

This is more appropriated for smaller sample sizes Using the
[**fastclust**](https://cran.r-project.org/package=fastclust)-package.

```{r clustering}
library(fastcluster)
beta <- getBeta(RGset[,1:16], type="Illumina")
d <- dist(t(beta),method="euclidean")
fit <- hclust(d, method="average")
plot(fit)
```
  
```{r clusteringhighlight}
Interesting <- sample(colnames(beta),1)
colorLeafs <- function(x) {
  if (is.leaf(x) && attr(x, "label") %in% Interesting) {
    attr(x, "nodePar") <- list(lab.col="red", pch=NA)
  }
  return(x)
} 
dd <- dendrapply(as.dendrogram(fit), colorLeafs)
op <- par(mar=c(10,4,4,2))
plot(dd)
par(op)
```

