---
title: "Functional Normalization"
output: 
  html_document:
    highlight: tango
    toc: true
    toc_float:
      collapsed: false
---

```{r, child="_setup.Rmd"}
```

We prefer normalization of 450K data using the Functional
Normalization approach of Fortin et al.[@Fortin2014]. Functional
Normalization includes NOOB background and dye bias
correction[@Triche2013].

In our experience the default number of principal compontents (2) is
often to small. We use a screeplot to determine the optimal number of
PC to use in the Function Normalization.

```{r screeplot}
pc <- screeplot(RGset)
``` 

Furthermore, by default Functional Normalization returns normalized
copy number data making the return `GenomicRatioSet` twice the size
necessary of only beta-values or M-values are required. Therefore, we
slightly modified minfi's implementation of Functional Normalization
to allow for not returning normalized copy number data.

```{r funnorm}
GRset <- preprocessFunnorm.DNAmArray(RGset, nPCs=3, keepCN=FALSE)
```

By default `preprocessFunnorm` return beta-values calculated with an
offset of 100, like GenomeStudio. If required these can be transformed
to M-values using minfi's `getM` which does a logit2-transformation on
the beta-values.

We recommend to perform probe-filtering which sets unreliable measured
probes to NA. Unfortunately, Functional Normalization does not allow
NA's in the `RGChannelSet`. Therefore, we combine after noramlization
and probe filtering the filtered-`RGChannelSet` and the
normalized-`GenomicRatioSet` using the function `reduce`.




