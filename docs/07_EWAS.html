<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>07_EWAS.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 54px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h2 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h3 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h4 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h5 {
  padding-top: 59px;
  margin-top: -59px;
}
.section h6 {
  padding-top: 59px;
  margin-top: -59px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">DNAmArray</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="01_GettingStarted.html">Getting Started</a>
</li>
<li>
  <a href="02_SampleQualityControl.html">Sample-level QC</a>
</li>
<li>
  <a href="03_Normalization.html">Normalization</a>
</li>
<li>
  <a href="04_ProbeFiltering.html">Probe-level QC</a>
</li>
<li>
  <a href="05_Predict.html">Predictors</a>
</li>
<li>
  <a href="06_Masking.html">Underperforming Probes</a>
</li>
<li>
  <a href="07_EWAS.html">Analysis</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<hr />
<div id="covariates" class="section level1">
<h1>Covariates</h1>
<p>Each column in the <code>RGset</code> colData should be considered as a potential covariate in our models. Both technical and biological factors should be investigated as these may introduce batch effects or be clinically relevant. In order to assess this, we convert each column to a categorical variable whose correlations can be visualised.</p>
<p>Homogenous columns can be excluded, as any variables that do not change by definition cannot explain variation in the data. In this instance, the <code>description</code> for all samples is peripheral whole blood, so there is no need to investigate a tissue effect. However, in some instances samples may be taken from different tissues, and in this type of study analysis must be done separately for each to correctly separate clinically relevant methylation changes from tissue-specific methylation differences.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">colData</span>(RGset), <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">as.numeric</span>(<span class="kw">factor</span>(x)))</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">keep &lt;-<span class="st"> </span><span class="kw">apply</span>(df, <span class="dv">2</span>, sd) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">summary</span>(keep)</a></code></pre></div>
<pre><code>##    Mode    TRUE 
## logical      16</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">df &lt;-<span class="st"> </span>df[ , keep]</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">colnames</span>(df)</a></code></pre></div>
<pre><code>##  [1] &quot;geo_accession&quot;    &quot;cohort&quot;           &quot;sex&quot;              &quot;cc&quot;              
##  [5] &quot;age&quot;              &quot;growth&quot;           &quot;facial&quot;           &quot;cns&quot;             
##  [9] &quot;Basename&quot;         &quot;filenames&quot;        &quot;Sentrix_Position&quot; &quot;baso_perc&quot;       
## [13] &quot;eos_perc&quot;         &quot;lymph_perc&quot;       &quot;mono_perc&quot;        &quot;neut_perc&quot;</code></pre>
<p>As you can see, 16 columns need to be examined. These include sample identifiers, such as <code>title</code> and the <code>Basename</code> variable we created, as well as which <code>cohort</code> the participant was from. Other potential causes of variation are biological, such as <code>age</code>, <code>sex</code>, and <code>cc_status</code>, and some, like <code>Sentrix_Position</code> and the blood cell counts, represent potential batch effects or confounding.</p>
<p>Correlations between complete factors and the principal components is calculated, and this correlation matrix is then melted using the <code>melt()</code> function from the <a href="https://cran.r-project.org/web/packages/reshape2/index.html"><strong>reshape2</strong></a> package. This prepares it for visualization using <a href="https://ggplot2.tidyverse.org/"><strong>ggplot2</strong></a>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(irlba)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">pc &lt;-<span class="st"> </span><span class="kw">prcomp_irlba</span>(<span class="kw">t</span>(betas), <span class="dt">n=</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">cxy &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">cor</span>(pc<span class="op">$</span>x, <span class="kw">scale</span>(df)),<span class="dv">2</span>)  </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">cxy[ , <span class="dv">1</span><span class="op">:</span><span class="dv">9</span>]</a></code></pre></div>
<pre><code>##     geo_accession cohort   sex    cc   age growth facial   cns Basename
## PC1         -0.28  -0.16  0.99  0.06  0.03  -0.08  -0.07 -0.11    -0.28
## PC2         -0.03   0.13  0.10 -0.25  0.03   0.18   0.22  0.27    -0.03
## PC3          0.70   0.89  0.00 -0.02  0.28  -0.01  -0.03  0.04     0.70
## PC4         -0.15  -0.34 -0.01  0.20 -0.03  -0.14  -0.15 -0.09    -0.15
## PC5         -0.05   0.08 -0.02 -0.36 -0.14   0.27   0.36  0.22    -0.05
## PC6         -0.02   0.07  0.02 -0.01 -0.10  -0.03   0.00  0.01    -0.02</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">library</span>(reshape2)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">melted_cxy &lt;-<span class="st"> </span><span class="kw">melt</span>(cxy)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">head</span>(melted_cxy)</a></code></pre></div>
<pre><code>##   Var1          Var2 value
## 1  PC1 geo_accession -0.28
## 2  PC2 geo_accession -0.03
## 3  PC3 geo_accession  0.70
## 4  PC4 geo_accession -0.15
## 5  PC5 geo_accession -0.05
## 6  PC6 geo_accession -0.02</code></pre>
<p>After some aesthetic preparation of the <code>theme()</code>, the correlations can be visualized in a heatmap using <a href="https://ggplot2.tidyverse.org/"><strong>ggplot2</strong></a>’s <code>geom_tile()</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="dt">data =</span> melted_cxy, <span class="kw">aes</span>(<span class="dt">x=</span>Var1, <span class="dt">y=</span>Var2, <span class="dt">fill=</span>value)) <span class="op">+</span><span class="st"> </span>th2 <span class="op">+</span><span class="st"> </span>th3 <span class="op">+</span><span class="st"> </span>th4 <span class="op">+</span><span class="st"> </span>th5 <span class="op">+</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">colour=</span><span class="st">&quot;#adadad&quot;</span>,<span class="dt">size=</span><span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Heatmap of Correlations&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>,<span class="dt">y=</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p><img src="07_EWAS_files/figure-html/704heatmapgg-1.png" width="672" /></p>
<p>By examining the correlations in the data, we can build our model in a more informed manner. The first PC is highly correlated with sex and, as is usual in EWAS, we intend to include this as a confounder. Cell counts appear of substantial importance and will also be adjusted for. Model specification should be informed by a combination of prior knowledge and inspection of patterns in the data.</p>
<p>Below we will specify a model adjusting for age, sex, sentrix position, cell counts, and cohort. It is not appropriate to adjust for sample ID type variables, such as Basename, despite their correlation with our PCs.</p>
<hr />
</div>
<div id="ewas-using-cate" class="section level1">
<h1>EWAS using <code>cate</code></h1>
<p>The package <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a> uses high dimensional factor analysis to adjust for measured and unmeasured confounding in multiple hypothesis testing. Unmeasured confounders, which are correlated with both methylation and case-control status, can bias the results from association tests. This makes this method superior to using <a href="https://bioconductor.org/packages/release/bioc/html/limma.html"><strong>limma</strong></a>, since it both corrects for technical variation and performs robust linear regression.</p>
<p>We advise using <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a> over PCA, since you can specify that factors should be independent of the outcome of interest. This is not the case in PCA, which can result in biological variation being removed.</p>
<p>The first step in running an EWAS is to make sure that you have information on all your confounders, and that these are stored in a design matrix. This matrix should be created using the <code>model.matrix()</code> function, so that variables are treated correctly.</p>
<p>The formula that will be used for our EWAS is stored inside the <code>RangedSummarizeExperiment</code> and called when creating the design matrix, after ensuring that none of the covariates contain missing values. We adjust for measured confounders, including age, sex, sentrix position, and estimated cell percentages.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">metadata</span>(methData)<span class="op">$</span>formula &lt;-<span class="st"> </span><span class="er">~</span>cc <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>Sentrix_Position <span class="op">+</span><span class="st"> </span>cohort <span class="op">+</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span>baso_perc <span class="op">+</span><span class="st"> </span>eos_perc <span class="op">+</span><span class="st"> </span>lymph_perc <span class="op">+</span><span class="st"> </span>mono_perc <span class="op">+</span><span class="st"> </span>neut_perc</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">covariates &lt;-<span class="st"> </span><span class="kw">get_all_vars</span>(<span class="kw">metadata</span>(methData)<span class="op">$</span>formula, <span class="dt">data=</span><span class="kw">colData</span>(methData))</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">nas &lt;-<span class="st"> </span><span class="kw">apply</span>(covariates, <span class="dv">1</span>, anyNA)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">methData &lt;-<span class="st"> </span>methData[, <span class="op">!</span>nas]</a>
<a class="sourceLine" id="cb10-7" data-line-number="7"></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">design &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="kw">metadata</span>(methData)<span class="op">$</span>formula, <span class="dt">data=</span><span class="kw">colData</span>(methData))</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">design[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>##                              (Intercept) ccdisease state: FASD age
## GSM3092700_9985178096_R01C01           1                     0  50
## GSM3092701_9985178127_R03C02           1                     0  19
## GSM3092702_9986360109_R02C02           1                     0 110
## GSM3092703_9985178087_R01C01           1                     0  39
## GSM3092704_9985178090_R01C01           1                     0  97</code></pre>
<p>To correct for unknown confounders, we must estimate their number using the <code>est.confounder.num()</code> function from <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a>. In order to correctly input the arguments of this function you need to specify the variable of interest, which in this instance is case-control status, followed by a formula indicating that all other variables except the intercept are known confounders. This function also needs the design matrix as a data frame, the transposed beta values, and an indication of what methods and number of iterations you want to use.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">library</span>(cate)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">beta.cate &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">assays</span>(methData)<span class="op">$</span>betas)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">factor.num &lt;-<span class="st"> </span><span class="kw">est.confounder.num</span>(<span class="op">~</span><span class="st"> `</span><span class="dt">ccdisease state: FASD</span><span class="st">`</span> <span class="op">|</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">                                   </span>. <span class="op">-</span><span class="st"> `</span><span class="dt">ccdisease state: FASD</span><span class="st">`</span> <span class="op">+</span><span class="st"> </span><span class="dv">0</span>, </a>
<a class="sourceLine" id="cb12-6" data-line-number="6">                                 <span class="kw">as.data.frame</span>(design), beta.cate, </a>
<a class="sourceLine" id="cb12-7" data-line-number="7">                                 <span class="dt">method =</span> <span class="st">&quot;bcv&quot;</span>, <span class="dt">bcv.plot =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb12-8" data-line-number="8">                                 <span class="dt">rmax =</span> <span class="dv">30</span>, <span class="dt">nRepeat =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">factor.num<span class="op">$</span>r</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>In this instance, it is suggested we correct for 10 unmeasured confounders. To implement this, we use the <code>cate.fit()</code> function, as shown below. The output object stores the beta values, estimated test statistics, and relevant p-values, and top hits can be viewed after using the Bonferonni correction to adjust for multiple testing.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">results.cate &lt;-<span class="st"> </span><span class="kw">cate.fit</span>(design[,<span class="dv">2</span>,<span class="dt">drop=</span><span class="ot">FALSE</span>], design[,<span class="op">-</span><span class="dv">2</span>], beta.cate, </a>
<a class="sourceLine" id="cb14-2" data-line-number="2">                         <span class="dt">r =</span> <span class="dv">10</span>, <span class="dt">calibrate=</span><span class="ot">FALSE</span>, <span class="dt">adj.method=</span><span class="st">&quot;naive&quot;</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">padj.cate &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(<span class="kw">sort</span>(results.cate<span class="op">$</span>beta.p.value[,<span class="dv">1</span>], <span class="dt">decreasing=</span><span class="ot">FALSE</span>), <span class="dt">method=</span><span class="st">&quot;bonf&quot;</span>)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="kw">head</span>(padj.cate[padj.cate <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>])</a></code></pre></div>
<pre><code>##   cg18420599   cg20893180   cg00121876   cg10646368   cg04613258   cg26530706 
## 0.000000e+00 9.186873e-11 9.186873e-11 6.430811e-10 2.847931e-09 3.123537e-09</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">length</span>(padj.cate[padj.cate <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>])</a></code></pre></div>
<pre><code>## [1] 297</code></pre>
<p>This analysis has identified 297 differentially methylated probes (DMPs) associated with FASD after adjusting for age, sex, and sentrix position. These can be analysed further, but first we want to outline alternatives to the <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a>-based EWAS, and demonstrate that results are comparable.</p>
<hr />
</div>
<div id="alternatives" class="section level1">
<h1>Alternatives</h1>
<p><a href="https://bioconductor.org/packages/release/bioc/html/limma.html"><strong>Limma</strong></a> is a package with excellent documentation that can be useful for smaller samples, due to the optional empirical Bayes step. Running <a href="https://bioconductor.org/packages/release/bioc/html/limma.html"><strong>limma</strong></a> is similar to running <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a>, except that the beta matrix does not need transposing and test statistics and p-values need to be manually derived.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">beta.limma &lt;-<span class="st"> </span><span class="kw">assays</span>(methData)<span class="op">$</span>betas</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="kw">library</span>(limma)</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">fit &lt;-<span class="st"> </span><span class="kw">lmFit</span>(beta.limma, design)</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">tstat &lt;-<span class="st"> </span>fit<span class="op">$</span>coef<span class="op">/</span>fit<span class="op">$</span>stdev.unscaled<span class="op">/</span>fit<span class="op">$</span>sigma</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">pval &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span><span class="kw">pnorm</span>(<span class="op">-</span><span class="kw">abs</span>(tstat[,<span class="dv">2</span>]))</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">padj &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(<span class="kw">sort</span>(pval, <span class="dt">decreasing=</span><span class="ot">FALSE</span>), <span class="dt">method=</span><span class="st">&quot;bonf&quot;</span>)</a>
<a class="sourceLine" id="cb18-9" data-line-number="9"></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="kw">head</span>(padj[padj <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>])</a></code></pre></div>
<pre><code>##   cg18420599   cg00121876   cg20893180   cg10646368   cg04613258   cg26530706 
## 2.425952e-11 5.279661e-11 8.177351e-11 6.221082e-10 2.815284e-09 3.132579e-09</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">length</span>(padj[padj <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>])</a></code></pre></div>
<pre><code>## [1] 297</code></pre>
<p>As shown, results from <a href="https://bioconductor.org/packages/release/bioc/html/limma.html"><strong>limma</strong></a> are comparable with those from <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a>. Here, the same number of DMPs are identified and top hits are identical, albeit with slightly differing p-values. Despite this, for the reasons specified above, we still advise using <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a> unless your sample size is small enough to require the <code>eBayes</code> option.</p>
<p>Linear mixed models and linear models can both work well for performing EWAS and, when looking solely at top hits, are unlikely to differ greatly from results obtained using <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a> or <a href="https://bioconductor.org/packages/release/bioc/html/limma.html"><strong>limma</strong></a>.</p>
<hr />
</div>
<div id="bacon" class="section level1">
<h1><code>bacon</code></h1>
<p>We developed a package called <a href="http://bioconductor.org/packages/bacon"><strong>bacon</strong></a> <span class="citation">[@VanIterson2017]</span> to estimate and correct for bias and inflation of test statistics in EWAS. This maximizes power while properly controlling the false positive rate, by estimating the empirical null distribution using Bayesian statistics. The utility of the tool was illustrated through the application of meta-analysis by performing epigenome- and transcriptome-wide association studies (EWASs/TWASs) on age and smoking which highlighted an overlap in differential methylation and expression of associated genes. It can be used to remove inflation and bias often observed in EWAS.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">library</span>(bacon)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">tstats &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">limma=</span>tstat[,<span class="dv">2</span>], <span class="dt">cate=</span><span class="kw">as.vector</span>(results.cate<span class="op">$</span>beta.t))</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="kw">library</span>(BiocParallel)</a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="kw">register</span>(<span class="kw">MulticoreParam</span>(<span class="dv">6</span>))</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">bc &lt;-<span class="st"> </span><span class="kw">bacon</span>(tstats)</a></code></pre></div>
<pre><code>## Detected 2 workers!
##  Running in parallel!</code></pre>
<p>Plots can be used to compare adjustment using <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a> with that using <a href="http://bioconductor.org/packages/bacon"><strong>bacon</strong></a>, and bacon-adjusted <a href="https://bioconductor.org/packages/release/bioc/html/limma.html"><strong>limma</strong></a> and <a href="https://cran.r-project.org/web/packages/cate/index.html"><strong>cate</strong></a> values can be compared side by side.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">plot</span>(bc, <span class="dt">type=</span><span class="st">&quot;hist&quot;</span>))</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="07_EWAS_files/figure-html/710baconplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">plot</span>(bc, <span class="dt">type=</span><span class="st">&quot;qq&quot;</span>))</a></code></pre></div>
<p><img src="07_EWAS_files/figure-html/710baconplot-2.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">pvalsbc &lt;-<span class="st"> </span><span class="kw">pval</span>(bc)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">head</span>(pvalsbc[<span class="kw">order</span>(pvalsbc[,<span class="dv">1</span>]),])</a></code></pre></div>
<pre><code>##                   limma         cate
## cg00121876 4.415519e-14 4.438737e-14
## cg09249404 1.025937e-11 1.030006e-11
## cg18420599 3.683593e-11 3.720331e-11
## cg20893180 8.394516e-11 8.475689e-11
## cg08532057 2.300984e-10 2.308458e-10
## cg23522872 2.550714e-10 2.558940e-10</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">pvals &lt;-<span class="st"> </span><span class="kw">pval</span>(bc, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="kw">head</span>(pvals[<span class="kw">order</span>(pvals[,<span class="dv">1</span>]),])</a></code></pre></div>
<pre><code>##                   limma         cate
## cg18420599 5.863470e-17 5.863470e-17
## cg00121876 1.276082e-16 1.276082e-16
## cg20893180 1.976447e-16 1.976447e-16
## cg10646368 1.503621e-15 1.503621e-15
## cg04613258 6.804477e-15 6.804477e-15
## cg26530706 7.571372e-15 7.571372e-15</code></pre>
<p>After looking at these plots, strong bias is observed, and running <a href="http://bioconductor.org/packages/bacon"><strong>bacon</strong></a> should be seriously considered.</p>
<hr />
</div>
<div id="dmr-finder" class="section level1">
<h1>DMR Finder</h1>
<p>This <code>DNAmArray</code> package also contains a <a href="https://epigeneticsandchromatin.biomedcentral.com/articles/10.1186/1756-8935-6-26"><strong>DMRfinder</strong></a> (Slieker, 2013) function, which can be used to identify differentially methylated regions (DMRs). This function takes a simple data frame as input, which needs to contain a column called <code>crit</code> with a binary indicator of whether the adjusted p-value was significant or not. Other options include <code>mismatches</code>, which specifies how many DMPs are allowed to be not significant in a row before a region is not deemed to be a DMR, and the <code>icd</code> or Inter-CpG distance required for a region to be identified.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">dmrData &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">dmp =</span> <span class="kw">attr</span>(padj.cate, <span class="st">&quot;names&quot;</span>), <span class="dt">crit =</span> <span class="kw">ifelse</span>(padj.cate<span class="op">&lt;</span><span class="fl">0.05</span>,<span class="dv">1</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"></a>
<a class="sourceLine" id="cb31-3" data-line-number="3">DMRs =<span class="st"> </span><span class="kw">DMRfinder</span>(dmrData, <span class="dt">mismatches=</span><span class="dv">3</span>, <span class="dt">icd=</span><span class="dv">1000</span>)</a></code></pre></div>
<pre><code>## 
## =============================================================================</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">DMRs</a></code></pre></div>
<pre><code>## GRanges object with 16 ranges and 0 metadata columns:
##        seqnames              ranges strand
##           &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt;
##    [1]     chr1   27683345-27683386      *
##    [2]     chr2 121625577-121625735      *
##    [3]     chr2 206628553-206628692      *
##    [4]     chr4     5710761-5711301      *
##    [5]     chr5     8457548-8458392      *
##    ...      ...                 ...    ...
##   [12]    chr17   76886742-76886912      *
##   [13]    chr18     5891948-5892213      *
##   [14]    chr18   11850139-11850153      *
##   [15]    chr18   32173084-32173227      *
##   [16]    chr19   36484913-36485360      *
##   -------
##   seqinfo: 11 sequences from an unspecified genome; no seqlengths</code></pre>
<p>In this instance, 16 DMRs were found to be associated with FASD. These regions can be visualised with a chromosome-based circo plot, such as using <a href="http://bioconductor.org/packages/release/bioc/html/OmicCircos.html"><strong>OmicCircos</strong></a> to get a better understanding of the regions identified.</p>
<hr />
</div>
<div id="probe-annotation" class="section level1">
<h1>Probe Annotation</h1>
<p>Our package also contains a <code>cpgInfo()</code> function, which can be used to map CpG probes to their nearest genes. This utilises the <a href="http://bioconductor.statistik.tu-dortmund.de/packages/3.6/data/annotation/html/TxDb.Hsapiens.UCSC.hg19.knownGene.html"><strong>TxDb.Hsapiens.UCSC.hg19.knownGene</strong></a> package, which accesses the USCS annotation databases.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">cpgs &lt;-<span class="st"> </span><span class="kw">names</span>(methData)</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">cpgInfo &lt;-<span class="st"> </span><span class="kw">cpgInfo</span>(cpgs, <span class="dt">TxDb=</span><span class="st">&quot;TxDb.Hsapiens.UCSC.hg19.knownGene&quot;</span>)</a></code></pre></div>
<pre><code>##   403 genes were dropped because they have exons located on both strands
##   of the same reference sequence or on more than one reference sequence,
##   so cannot be represented by a single genomic range.
##   Use &#39;single.strand.genes.only=FALSE&#39; to get all the genes in a
##   GRangesList object, or use suppressMessages() to suppress this message.</code></pre>
<pre><code>## Fetching coordinates for hg19...</code></pre>
<pre><code>## &#39;select()&#39; returned many:1 mapping between keys and columns</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">cpgInfo[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>]</a></code></pre></div>
<pre><code>##            seqnames     start       end  width strand gene_id  SYMBOL
## cg00000957     chr1   5922870   6052533 129664      -  261734   NPHP4
## cg00001349     chr1 166944819 166991447  46629      +   84944    MAEL
## cg00001583     chr1 199996730 200146550 149821      +    2494   NR5A2
## cg00002028     chr1  20959948  20978004  18057      +   65018   PINK1
## cg00002719     chr1 169364114 169429907  65794      -   57821 CCDC181
## cg00002837     chr1  44514030  44600809  86780      +  128209   KLF17
## cg00003202     chr1 151313116 151319769   6654      -    5993    RFX5
## cg00003287     chr1 201328136 201346828  18693      -    7139   TNNT2
## cg00007036     chr1  33722174  33766320  44147      +  149076  ZNF362
## cg00007898     chr1 205111631 205180727  69097      -   25778   DSTYK</code></pre>
<hr />
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
