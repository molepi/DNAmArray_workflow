
```{r, child="_setup.Rmd"}
```

# Different ways to visualize DNAm array data #

Here we show different ways to inspect DNAm array data with emphasis
on fast and efficient tools for large data sets.

# Beta densities #

To get a global impression of the beta-value distribution and to see
if there are outlying samples the per sample average beta-value
distribution can be plotted. For example, using `densityPlot` from
[**minfi**](http://bioconductor.org/packages/minfi).

```{r}
library(minfi)
densityPlot(RGset[, 1:10], main = "Beta", xlab = "Beta")
``` 

# Principal components plot #

A plot of the first principal components can be used for exploratory
data analysis. The
[**irlba**](https://cran.r-project.org/package=irlba)-package provides
an efficient algorithm for the calculation of principal components.

> NOTE: The irlba-algorithm doesn't allow any NA's

```{r irlba}
library(irlba)
beta <- getBeta(RGset, type="Illumina")
beta[is.na(beta)] <- median(beta, na.rm=TRUE)
pc <- prcomp_irlba(t(beta), n=3)
summary(pc)
plot(pc$x)
```

The first principale component explains almost 50% of the variation
and two groups of samples appear; these are male and female samples!
Often probes on the sex-chromosomes are excluded before principale
component analysis (or other analyzes).

> NOTE: `getBeta` extracts Methylated and Unmethylated intensities and
> converts them to beta-values by default using M/(M+U), whereas,
> `type="Illumina"` adds 100 to the denominator which prevents
> beta-values becoming NA if both M and U are exactly zero.

# Heatmap #

A heatmap of correlations of the previously calculated principale
components with technical/biological covariates to indicate which
covariates should be included in association study.

```{r heatmap}
library(pheatmap)
df <- apply(targets, 2, function(x) as.numeric(factor(x)))
keep <- apply(df, 2, sd) > 0    
cxy <- cor(pc$x, scale(df[, keep]))   
pheatmap(cxy, cluster_rows=FALSE)
```

# Dendrogram #

Another approach, often used in expression data, for exploratory data
analysis is clustering of the data and visualizing using a
dendrogram. Although, this might be more appropriated for data sets
with moderated sample sizes, the
[**fastclust**](https://cran.r-project.org/package=fastclust)-package
is efficient in generating the hierarchical clustering.

```{r clustering}
library(fastcluster)
beta <- getBeta(RGset[,1:16], type="Illumina")
d <- dist(t(beta),method="euclidean")
fit <- hclust(d, method="average")
plot(fit)
```
  
Highlighting a suspected outlier can be convenient.
  
```{r clusteringhighlight}
Interesting <- sample(colnames(beta),1)
colorLeafs <- function(x) {
  if (is.leaf(x) && attr(x, "label") %in% Interesting) {
    attr(x, "nodePar") <- list(lab.col="red", pch=NA)
  }
  return(x)
} 
dd <- dendrapply(as.dendrogram(fit), colorLeafs)
op <- par(mar=c(10,4,4,2))
plot(dd)
```


```{r echo=FALSE}
par(op)
```



